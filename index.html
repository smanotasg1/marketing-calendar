import React, { useState, useEffect } from "react";

import { initializeApp } from "firebase/app";
import { getFirestore, collection, onSnapshot, setDoc, doc } from "firebase/firestore";

const firebaseConfig = {
  apiKey: "AIzaSyDDbdGShwSdidFWMd__mISqiX7Y8BCcVdA",
  authDomain: "marketing-calendar-f126f.firebaseapp.com",
  projectId: "marketing-calendar-f126f",
  storageBucket: "marketing-calendar-f126f.firebasestorage.app",
  messagingSenderId: "199471456003",
  appId: "1:199471456003:web:747296324223c771add336"
};

// Inicializa Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const calendarsRef = collection(db, "calendars");

const App = () => {
  const [calendars, setCalendars] = useState([]);
  const [activeCalendar, setActiveCalendar] = useState(null);
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [newCalendarName, setNewCalendarName] = useState("");
  const [editingCell, setEditingCell] = useState(null);
  const [editValue, setEditValue] = useState("");
  const [editingTime, setEditingTime] = useState(null);
  const [timeValue, setTimeValue] = useState("");
  const [showClearConfirm, setShowClearConfirm] = useState(false);
  const [showDeleteCalendarConfirm, setShowDeleteCalendarConfirm] = useState(null);
  const [showDeleteTimeSlotConfirm, setShowDeleteTimeSlotConfirm] = useState(null);
  const [showLabelManager, setShowLabelManager] = useState(false);
  const [labelType, setLabelType] = useState('platforms');
  const [newLabel, setNewLabel] = useState('');
  const [customLabels, setCustomLabels] = useState({ platforms: [], contentTypes: [] });
  const [labelNames, setLabelNames] = useState({ platforms: "Platforms", contentTypes: "Content" });

  // Initialize with default calendar if none exists
 useEffect(() => {
  const unsubscribe = onSnapshot(calendarsRef, (snapshot) => {
    const data = snapshot.docs.map(doc => doc.data());
    if (data.length > 0) {
      setCalendars(data);
      setActiveCalendar(data[0]);
    } else {
      const defaultCalendar = createDefaultCalendar("Default Calendar");
      setCalendars([defaultCalendar]);
      setActiveCalendar(defaultCalendar);
      setDoc(doc(db, "calendars", defaultCalendar.id.toString()), defaultCalendar);
    }
  });

  return () => unsubscribe();
}, []);

  // Save calendars and labels to localStorage whenever they change
 useEffect(() => {
  if (calendars.length > 0) {
    calendars.forEach(cal => {
      setDoc(doc(db, "calendars", cal.id.toString()), cal);
    });
  }
}, [calendars]);

useEffect(() => {
  if (customLabels) {
    // Si quieres guardar customLabels en Firebase, crea otra colección
    // Por ahora, solo guardamos los calendarios
  }
}, [customLabels, labelNames]);

  const createDefaultCalendar = (name) => {
    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    const timeWindows = [
      "12:30 to 13:00",
      "14:30 to 15:00", 
      "15:00 to 15:30",
      "16:00 to 16:30",
      "16:30 to 17:00",
      "18:00 to 18:30",
      "18:30 to 19:00"
    ];

    return {
      id: Date.now(),
      name,
      days: [...days],
      timeWindows: [...timeWindows],
      activities: timeWindows.map(timeWindow => ({
        timeWindow,
        tasks: days.map(day => ({
          day,
          task: "",
          subtask: "",
          details: "",
          platforms: [],
          contentTypes: []
        }))
      }))
    };
  };

  const handleCreateCalendar = () => {
    if (newCalendarName.trim() && calendars.length < 10) {
      const newCalendar = createDefaultCalendar(newCalendarName.trim());
      setCalendars(prev => [...prev, newCalendar]);
      setActiveCalendar(newCalendar);
      setNewCalendarName("");
      setShowCreateModal(false);
    }
  };

  const handleDeleteCalendar = (calendarId) => {
    if (calendars.length <= 1) return; // Prevent deleting last calendar
    
    const updatedCalendars = calendars.filter(cal => cal.id !== calendarId);
    setCalendars(updatedCalendars);
    
    if (activeCalendar.id === calendarId) {
      setActiveCalendar(updatedCalendars[0]);
    }
    
    setShowDeleteCalendarConfirm(null);
  };

  const handleEditCell = (activityIndex, dayIndex, field, value) => {
    const updatedCalendar = { ...activeCalendar };
    if (!updatedCalendar.activities[activityIndex].tasks[dayIndex].hasOwnProperty(field)) {
      updatedCalendar.activities[activityIndex].tasks[dayIndex][field] = "";
    }
    updatedCalendar.activities[activityIndex].tasks[dayIndex][field] = value;
    
    setCalendars(prev => prev.map(cal => 
      cal.id === activeCalendar.id ? updatedCalendar : cal
    ));
    setActiveCalendar(updatedCalendar);
  };

  const handleEditLabels = (activityIndex, dayIndex, labelType, label) => {
    const updatedCalendar = { ...activeCalendar };
    const task = updatedCalendar.activities[activityIndex].tasks[dayIndex];
    
    // Initialize array if it doesn't exist
    if (!task[labelType]) {
      task[labelType] = [];
    }
    
    const labelIndex = task[labelType].indexOf(label);
    
    if (labelIndex === -1) {
      task[labelType].push(label);
    } else {
      task[labelType].splice(labelIndex, 1);
    }
    
    setCalendars(prev => prev.map(cal => 
      cal.id === activeCalendar.id ? updatedCalendar : cal
    ));
    setActiveCalendar(updatedCalendar);
  };

  const handleEditTime = (activityIndex, timeValue) => {
    const updatedCalendar = { ...activeCalendar };
    updatedCalendar.timeWindows[activityIndex] = timeValue;
    updatedCalendar.activities[activityIndex].timeWindow = timeValue;
    
    setCalendars(prev => prev.map(cal => 
      cal.id === activeCalendar.id ? updatedCalendar : cal
    ));
    setActiveCalendar(updatedCalendar);
  };

  const startEditing = (activityIndex, dayIndex, field, currentValue) => {
    setEditingCell({ activityIndex, dayIndex, field });
    setEditValue(currentValue || "");
  };

  const startEditingTime = (activityIndex, timeValue) => {
    setEditingTime(activityIndex);
    setTimeValue(timeValue || "");
  };

  const saveEdit = () => {
    if (editingCell && editValue !== "") {
      handleEditCell(editingCell.activityIndex, editingCell.dayIndex, editingCell.field, editValue);
      setEditingCell(null);
      setEditValue("");
    }
  };

  const saveTimeEdit = () => {
    if (editingTime !== null && timeValue.trim() !== "") {
      handleEditTime(editingTime, timeValue.trim());
      setEditingTime(null);
      setTimeValue("");
    }
  };

  const cancelEdit = () => {
    setEditingCell(null);
    setEditValue("");
  };

  const cancelTimeEdit = () => {
    setEditingTime(null);
    setTimeValue("");
  };

  const addTimeSlot = () => {
    const updatedCalendar = { ...activeCalendar };
    const newTime = "New Time Slot";
    updatedCalendar.timeWindows.push(newTime);
    updatedCalendar.activities.push({
      timeWindow: newTime,
      tasks: updatedCalendar.days.map(day => ({
        day,
        task: "",
        subtask: "",
        details: "",
        platforms: [],
        contentTypes: []
      }))
    });
    
    setCalendars(prev => prev.map(cal => 
      cal.id === activeCalendar.id ? updatedCalendar : cal
    ));
    setActiveCalendar(updatedCalendar);
  };

  const deleteTimeSlot = (activityIndex) => {
    if (activeCalendar.timeWindows.length <= 1) return; // Prevent deleting last time slot
    
    const updatedCalendar = { ...activeCalendar };
    updatedCalendar.timeWindows.splice(activityIndex, 1);
    updatedCalendar.activities.splice(activityIndex, 1);
    
    setCalendars(prev => prev.map(cal => 
      cal.id === activeCalendar.id ? updatedCalendar : cal
    ));
    setActiveCalendar(updatedCalendar);
    
    setShowDeleteTimeSlotConfirm(null);
  };

  const clearAllData = () => {
    const updatedCalendar = { ...activeCalendar };
    // Clear all task data and time slots
    updatedCalendar.timeWindows = ["12:30 to 13:00"]; // Reset to default time slot
    updatedCalendar.activities = [{
      timeWindow: "12:30 to 13:00",
      tasks: updatedCalendar.days.map(day => ({
        day,
        task: "",
        subtask: "",
        details: "",
        platforms: [],
        contentTypes: []
      }))
    }];
    
    setCalendars(prev => prev.map(cal => 
      cal.id === activeCalendar.id ? updatedCalendar : cal
    ));
    setActiveCalendar(updatedCalendar);
    setShowClearConfirm(false);
  };

  const addCustomLabel = () => {
    if (newLabel.trim() && !customLabels[labelType].includes(newLabel.trim())) {
      setCustomLabels(prev => ({
        ...prev,
        [labelType]: [...prev[labelType], newLabel.trim()]
      }));
      setNewLabel('');
    }
  };

  const deleteCustomLabel = (type, label) => {
    setCustomLabels(prev => ({
      ...prev,
      [type]: prev[type].filter(l => l !== label)
    }));
  };

  const updateLabelName = (type, newName) => {
    if (newName.trim()) {
      setLabelNames(prev => ({
        ...prev,
        [type]: newName.trim()
      }));
    }
  };

  const renderCellContent = (task, activityIndex, dayIndex, field) => {
    const isEditing = editingCell?.activityIndex === activityIndex && 
                      editingCell?.dayIndex === dayIndex && 
                      editingCell?.field === field;

    if (isEditing) {
      return (
        <div className="flex flex-col space-y-1 h-full">
          <textarea
            value={editValue}
            onChange={(e) => setEditValue(e.target.value)}
            autoFocus
            className="flex-1 p-1 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none bg-white text-gray-900"
            rows={field === 'details' ? 3 : 1}
            style={{ minHeight: '20px' }}
          />
          <div className="flex space-x-1 pt-1">
            <button
              onClick={saveEdit}
              className="bg-green-500 text-white px-2 py-1 text-xs rounded hover:bg-green-600"
            >
              Save
            </button>
            <button
              onClick={cancelEdit}
              className="bg-gray-500 text-white px-2 py-1 text-xs rounded hover:bg-gray-600"
            >
              Cancel
            </button>
          </div>
        </div>
      );
    }

    const content = task[field] || "";
    if (!content) {
      return (
        <button
          onClick={() => startEditing(activityIndex, dayIndex, field, "")}
          className="w-full h-full flex items-center justify-center text-gray-400 hover:text-gray-600 text-sm"
        >
          +
        </button>
      );
    }

    return (
      <div 
        onClick={() => startEditing(activityIndex, dayIndex, field, content)}
        className="cursor-pointer p-1 min-h-[20px] h-full"
      >
        {field === 'details' ? (
          <pre className="text-xs whitespace-pre-wrap text-gray-700">{content}</pre>
        ) : (
          <span className="text-sm">{content}</span>
        )}
      </div>
    );
  };

  const renderTimeContent = (time, activityIndex) => {
    const isEditing = editingTime === activityIndex;

    if (isEditing) {
      return (
        <div className="flex flex-col space-y-1 h-full">
          <input
            type="text"
            value={timeValue}
            onChange={(e) => setTimeValue(e.target.value)}
            autoFocus
            placeholder="Enter time (e.g., 12:30 to 13:00)"
            className="p-1 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-gray-900"
          />
          <div className="flex space-x-1 pt-1">
            <button
              onClick={saveTimeEdit}
              className="bg-green-500 text-white px-2 py-1 text-xs rounded hover:bg-green-600"
            >
              Save
            </button>
            <button
              onClick={cancelTimeEdit}
              className="bg-gray-500 text-white px-2 py-1 text-xs rounded hover:bg-gray-600"
            >
              Cancel
            </button>
          </div>
        </div>
      );
    }

    return (
      <div 
        onClick={() => startEditingTime(activityIndex, time)}
        className="cursor-pointer p-2 min-h-[20px] h-full"
      >
        <span className="text-sm">{time}</span>
      </div>
    );
  };

  const renderLabels = (task, activityIndex, dayIndex, labelType) => {
    const taskLabels = task[labelType] || [];
    const displayName = labelNames[labelType];
    
    return (
      <div className="flex flex-wrap gap-1 mt-1 pt-1 border-t">
        <p className="text-xs font-semibold text-gray-600 mr-2">{displayName}:</p>
        {taskLabels.map(label => (
          <button
            key={label}
            onClick={() => handleEditLabels(activityIndex, dayIndex, labelType, label)}
            className="text-xs px-2 py-1 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors"
          >
            {label}
          </button>
        ))}
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gray-900 text-white">
      {/* Header */}
      <div className="bg-gradient-to-r from-indigo-900 to-purple-900 p-6">
        <div className="max-w-7xl mx-auto text-center">
          <h1 className="text-4xl font-bold mb-2">Marketing Calendar Manager</h1>
          <p className="text-xl opacity-90">All in one place</p>
        </div>
      </div>

      <div className="max-w-7xl mx-auto p-6">
        {/* Calendar Management */}
        <div className="bg-gray-800 rounded-lg p-6 mb-8">
          <div className="flex flex-wrap items-center justify-between mb-6">
            <h2 className="text-2xl font-semibold">My Calendars</h2>
            <div className="flex items-center space-x-4">
              <span className="text-sm text-gray-300">
                {calendars.length}/10 calendars used
              </span>
              <button
                onClick={() => setShowCreateModal(true)}
                disabled={calendars.length >= 10}
                className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2 ${
                  calendars.length >= 10 
                    ? 'bg-gray-600 cursor-not-allowed' 
                    : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700'
                }`}
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                <span>Create New Calendar</span>
              </button>
            </div>
          </div>

          <div className="flex flex-wrap gap-3">
            {calendars.map(calendar => (
              <div
                key={calendar.id}
                className={`flex items-center space-x-3 px-4 py-3 rounded-xl cursor-pointer transition-all transform hover:scale-105 ${
                  activeCalendar?.id === calendar.id
                    ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg'
                    : 'bg-gray-700 hover:bg-gray-600 text-gray-200'
                }`}
                onClick={() => setActiveCalendar(calendar)}
              >
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd" />
                </svg>
                <span className="font-medium">{calendar.name}</span>
                {calendars.length > 1 && (
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      setShowDeleteCalendarConfirm(calendar.id);
                    }}
                    className="text-red-200 hover:text-red-100 ml-2 opacity-70 hover:opacity-100 transition-opacity"
                    title="Delete calendar"
                  >
                    ×
                  </button>
                )}
              </div>
            ))}
          </div>
        </div>

        {activeCalendar && (
          <>
            {/* Active Calendar Header */}
            <div className="bg-white rounded-xl shadow-xl p-6 mb-8">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-3xl font-bold text-gray-800 mb-2">{activeCalendar.name}</h2>
                  <p className="text-gray-600">
                    {activeCalendar.timeWindows.length} time slots • {activeCalendar.days.length} days
                  </p>
                </div>
                <div className="flex space-x-3">
                  <button
                    onClick={addTimeSlot}
                    className="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 flex items-center space-x-1"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                    <span>Add Time Slot</span>
                  </button>
                  <button
                    onClick={() => setShowLabelManager(true)}
                    className="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-purple-700 flex items-center space-x-1"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <span>Label Manager</span>
                  </button>
                  <button
                    onClick={() => setShowClearConfirm(true)}
                    className="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 flex items-center space-x-1"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    <span>Clear All</span>
                  </button>
                </div>
              </div>
            </div>

            {/* Calendar Table */}
            <div className="bg-white rounded-xl shadow-2xl overflow-hidden">
              <div className="overflow-x-auto">
                <table className="w-full table-fixed border-collapse">
                  <thead>
                    <tr>
                      <th className="bg-gradient-to-b from-gray-800 to-gray-700 text-white px-6 py-4 text-left min-w-56">
                        <div className="flex items-center space-x-2">
                          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd" />
                          </svg>
                          <span className="font-semibold">Time Window</span>
                        </div>
                      </th>
                      {activeCalendar.days.map((day) => (
                        <th
                          key={day}
                          className="bg-gradient-to-b from-indigo-500 to-indigo-600 text-white px-6 py-4 text-center min-w-40"
                        >
                          <div className="font-semibold">{day}</div>
                        </th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {activeCalendar.activities.map((activity, activityIndex) => (
                      <tr key={activity.timeWindow} className="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                        <td className="bg-gray-50 text-gray-800 px-6 py-4 text-left font-medium border-r border-gray-200 relative">
                          <div className="flex items-center justify-between">
                            <div className="flex-1">
                              {renderTimeContent(activity.timeWindow, activityIndex)}
                            </div>
                            {activeCalendar.timeWindows.length > 1 && (
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  setShowDeleteTimeSlotConfirm(activityIndex);
                                }}
                                className="text-red-500 hover:text-red-700 ml-2 opacity-70 hover:opacity-100 transition-opacity"
                                title="Delete time slot"
                              >
                                ×
                              </button>
                            )}
                          </div>
                        </td>
                        {activity.tasks.map((task, dayIndex) => (
                          <td key={`${activityIndex}-${dayIndex}`} className="px-3 py-4 border-l border-gray-100">
                            <div className="bg-gray-50 rounded-lg p-3 min-h-28 hover:bg-gray-100 transition-colors">
                              <div className="space-y-2">
                                <div
                                  className={`flex items-start ${
                                    task.task ? 'mb-1' : ''
                                  }`}
                                >
                                  {task.task && (
                                    <>
                                      <span className="bg-purple-500 text-white px-2 py-1 mr-2 rounded text-xs font-bold">|</span>
                                      <div className="text-sm font-semibold text-gray-800 flex-1">
                                        {renderCellContent(task, activityIndex, dayIndex, 'task')}
                                      </div>
                                    </>
                                  )}
                                  {!task.task && (
                                    <div className="w-full">
                                      {renderCellContent(task, activityIndex, dayIndex, 'task')}
                                    </div>
                                  )}
                                </div>
                                
                                <div
                                  className={`flex items-start ${
                                    task.subtask ? 'mb-1' : ''
                                  }`}
                                >
                                  {task.subtask && (
                                    <>
                                      <span className="bg-green-500 text-white px-2 py-1 mr-2 rounded text-xs font-bold">|</span>
                                      <div className="text-sm text-gray-700 flex-1">
                                        {renderCellContent(task, activityIndex, dayIndex, 'subtask')}
                                      </div>
                                    </>
                                  )}
                                  {!task.subtask && task.task && (
                                    <div className="w-full">
                                      {renderCellContent(task, activityIndex, dayIndex, 'subtask')}
                                    </div>
                                  )}
                                </div>
                                
                                {(task.details || (task.task && task.subtask)) && (
                                  <div className="text-xs text-gray-600 border-t pt-1 mt-1">
                                    {renderCellContent(task, activityIndex, dayIndex, 'details')}
                                  </div>
                                )}
                                
                                {/* Custom Label Selectors */}
                                <div className="flex flex-col space-y-2 mt-2 pt-2 border-t">
                                  {renderLabels(task, activityIndex, dayIndex, 'platforms')}
                                  {renderLabels(task, activityIndex, dayIndex, 'contentTypes')}
                                </div>
                              </div>
                            </div>
                          </td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>

            {/* Post Frequency */}
            <div className="mt-8 bg-white rounded-xl shadow-xl p-6">
              <h3 className="text-2xl font-semibold text-gray-800 mb-6 text-center">Post Frequency by Day</h3>
              <div className="grid grid-cols-7 gap-6">
                {activeCalendar.days.map((day, dayIndex) => {
                  const totalPosts = activeCalendar.activities.reduce((count, activity) => {
                    const task = activity.tasks[dayIndex];
                    return count + (task.task ? 1 : 0);
                  }, 0);

                  const colors = ['from-red-500 to-red-600', 'from-blue-500 to-blue-600', 'from-green-500 to-green-600', 
                                'from-purple-500 to-purple-600', 'from-orange-500 to-orange-600', 
                                'from-pink-500 to-pink-600', 'from-gray-500 to-gray-600'];
                  const color = colors[dayIndex % 7];

                  return (
                    <div key={day} className="text-center">
                      <p className="text-lg font-semibold text-gray-700 mb-3">{day}</p>
                      <div className={`bg-gradient-to-br ${color} text-white w-16 h-16 mx-auto rounded-full flex items-center justify-center text-2xl font-bold shadow-lg`}>
                        {totalPosts}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </>
        )}
      </div>

      {/* Create Calendar Modal */}
      {showCreateModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-8 max-w-md w-full">
            <div className="text-center mb-6">
              <div className="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </div>
              <h3 className="text-2xl font-bold text-gray-800 mb-2">Create New Calendar</h3>
              <p className="text-gray-600">
                You can create up to 10 calendars. You currently have {calendars.length} out of 10.
              </p>
            </div>
            <input
              type="text"
              value={newCalendarName}
              onChange={(e) => setNewCalendarName(e.target.value)}
              placeholder="Enter calendar name"
              className="w-full p-3 border border-gray-300 rounded-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900"
              autoFocus
            />
            <div className="flex space-x-3">
              <button
                onClick={handleCreateCalendar}
                disabled={!newCalendarName.trim() || calendars.length >= 10}
                className="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-6 rounded-lg hover:from-blue-700 hover:to-indigo-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all font-medium"
              >
                Create Calendar
              </button>
              <button
                onClick={() => {
                  setShowCreateModal(false);
                  setNewCalendarName("");
                }}
                className="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors font-medium"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Clear All Confirmation Modal */}
      {showClearConfirm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-8 max-w-md w-full">
            <div className="text-center mb-6">
              <div className="w-16 h-16 bg-gradient-to-r from-red-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <h3 className="text-2xl font-bold text-gray-800 mb-2">Clear All Data?</h3>
              <p className="text-gray-600">
                Are you sure you want to clear all data in this calendar? This will remove all content, time slots, and labels.
              </p>
            </div>
            <div className="flex space-x-3">
              <button
                onClick={clearAllData}
                className="flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-6 rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium"
              >
                Clear All Data
              </button>
              <button
                onClick={() => setShowClearConfirm(false)}
                className="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors font-medium"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Delete Calendar Confirmation Modal */}
      {showDeleteCalendarConfirm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-8 max-w-md w-full">
            <div className="text-center mb-6">
              <div className="w-16 h-16 bg-gradient-to-r from-red-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </div>
              <h3 className="text-2xl font-bold text-gray-800 mb-2">Delete Calendar?</h3>
              <p className="text-gray-600">
                Are you sure you want to delete this calendar? This action cannot be undone.
              </p>
            </div>
            <div className="flex space-x-3">
              <button
                onClick={() => handleDeleteCalendar(showDeleteCalendarConfirm)}
                className="flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-6 rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium"
              >
                Delete Calendar
              </button>
              <button
                onClick={() => setShowDeleteCalendarConfirm(null)}
                className="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors font-medium"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Delete Time Slot Confirmation Modal */}
      {showDeleteTimeSlotConfirm !== null && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-8 max-w-md w-full">
            <div className="text-center mb-6">
              <div className="w-16 h-16 bg-gradient-to-r from-red-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </div>
              <h3 className="text-2xl font-bold text-gray-800 mb-2">Delete Time Slot?</h3>
              <p className="text-gray-600">
                Are you sure you want to delete this time slot? This will remove all content associated with this time slot.
              </p>
            </div>
            <div className="flex space-x-3">
              <button
                onClick={() => deleteTimeSlot(showDeleteTimeSlotConfirm)}
                className="flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-6 rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium"
              >
                Delete Time Slot
              </button>
              <button
                onClick={() => setShowDeleteTimeSlotConfirm(null)}
                className="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg hover:bg-gray-600 transition-colors font-medium"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Label Manager Modal */}
      {showLabelManager && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl p-6 max-w-2xl w-full max-h-96 overflow-y-auto">
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-2xl font-bold text-gray-800">Label Manager</h3>
              <button
                onClick={() => setShowLabelManager(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            <div className="space-y-8">
              {/* Label Names Configuration */}
              <div>
                <h4 className="text-lg font-semibold text-gray-800 mb-4">Label Names</h4>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      First Label Name
                    </label>
                    <input
                      type="text"
                      value={labelNames.platforms}
                      onChange={(e) => updateLabelName('platforms', e.target.value)}
                      placeholder="Enter label name"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Second Label Name
                    </label>
                    <input
                      type="text"
                      value={labelNames.contentTypes}
                      onChange={(e) => updateLabelName('contentTypes', e.target.value)}
                      placeholder="Enter label name"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"
                    />
                  </div>
                </div>
              </div>

              {/* Custom Labels Management */}
              <div>
                <h4 className="text-lg font-semibold text-gray-800 mb-4">Custom Labels</h4>
                
                <div className="mb-6">
                  <div className="flex space-x-2 mb-4">
                    <button
                      onClick={() => setLabelType('platforms')}
                      className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                        labelType === 'platforms'
                          ? 'bg-blue-600 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      {labelNames.platforms}
                    </button>
                    <button
                      onClick={() => setLabelType('contentTypes')}
                      className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                        labelType === 'contentTypes'
                          ? 'bg-blue-600 text-white'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      {labelNames.contentTypes}
                    </button>
                  </div>

                  <div className="flex space-x-2 mb-4">
                    <input
                      type="text"
                      value={newLabel}
                      onChange={(e) => setNewLabel(e.target.value)}
                      placeholder={`Add new ${labelType === 'platforms' ? labelNames.platforms : labelNames.contentTypes}`}
                      className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"
                      onKeyPress={(e) => {
                        if (e.key === 'Enter') {
                          addCustomLabel();
                        }
                      }}
                    />
                    <button
                      onClick={addCustomLabel}
                      className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium"
                    >
                      Add
                    </button>
                  </div>

                  <div className="border border-gray-200 rounded-lg p-4 max-h-40 overflow-y-auto">
                    {customLabels[labelType].length > 0 ? (
                      <div className="space-y-2">
                        {customLabels[labelType].map(label => (
                          <div key={label} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                            <span className="text-gray-800">{label}</span>
                            <button
                              onClick={() => deleteCustomLabel(labelType, label)}
                              className="text-red-500 hover:text-red-700"
                            >
                              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                              </svg>
                            </button>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-gray-500 text-center py-4">
                        No custom labels added yet
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default App;
